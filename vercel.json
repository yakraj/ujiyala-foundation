{
  "version": 2,
  
  // 1. Custom Install Command: Required to install dependencies in both subfolders
  "installCommand": "npm install --prefix ./client && npm install --prefix ./server",
  
  "builds": [
    // 2. Client Build Configuration (React/Vite)
    {
      "src": "client/package.json",
      "use": "@vercel/static-build",
      "config": {
        // Vercel runs `npm run build` in the 'client' directory,
        // and expects the output in 'dist' (default for Vite).
        "distDir": "dist" 
      }
    },
    // 3. Server Build Configuration (Express.js API)
    {
      // IMPORTANT: Change 'index.js' to your server's main entry file (e.g., 'server.js')
      "src": "server/api/index.js", 
      "use": "@vercel/node"
    }
  ],
  
  "routes": [
    // 4. API Routes: Route requests starting with /api/ to the Express serverless function
    {
      "src": "/api/(.*)",
      "dest": "server/api/index.js" // Must match the src in the server 'builds' configuration
    },
    // 5. Client Routes: Route all other requests to the built React client's index.html
    {
      // This is the CRUCIAL part that ensures your React app (SPA) loads.
      "src": "/(.*)",
      "dest": "client/dist/index.html"
    }
  ]
}
